<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="http://localhost:4000/%E8%A7%82%E7%82%B9-%E6%83%B3%E8%BF%9B%E6%AD%A5%E7%9A%84%E7%AE%A1%E7%90%86%E8%80%85%E8%A6%81%E5%A4%9A%E8%AF%BB%E5%87%A0%E9%81%8D" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="      作者：费  敏        来源：蓝血研究（lanxueyanjiu)        蓝血研究文章，如需转载请通过后台向公众号申请  ">

  <meta property="og:site_name" content="BertrandDigitalGarden">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-DBYSXF7WKD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DBYSXF7WKD');
  </script> -->
  
  <!-- 
  <script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script>
  <link
    rel="stylesheet"
    href="https://unpkg.com/@waline/client@v2/dist/waline.css"
  />  
  -->
  
  
  <!-- <script async defer data-website-id="0dc17886-9c5c-4bb7-b097-104eb7c28c72" src="https://umami-production-7220.up.railway.app/umami.js"></script> -->
  
  
  <!-- Start of Howxm client code snippet -->
  <script>
  function _howxm(){_howxmQueue.push(arguments)}
  window._howxmQueue=window._howxmQueue||[];
  _howxm('setAppID','352e66d3-cc84-42ce-ac80-a43a12abf84b');
  (function(){var scriptId='howxm_script';
  if(!document.getElementById(scriptId)){
  var e=document.createElement('script'),
  t=document.getElementsByTagName('script')[0];
  e.setAttribute('id',scriptId);
  e.type='text/javascript';e.async=!0;
  e.src='https://static.howxm.com/sdk.js';
  t.parentNode.insertBefore(e,t)}})();
  </script>
  <!-- End of Howxm client code snippet -->
  
  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "jurm89uqvq");
  </script>
  
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/styles.css">

  
  <meta property="og:description" content="      作者：费  敏        来源：蓝血研究（lanxueyanjiu)        蓝血研究文章，如需转载请通过后台向公众号申请  "/>
  

  
  <meta property="og:title" content="【观点】想进步的管理者要多读几遍">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2024-03-09T23:52:57+08:00">
  <meta property="article:author" content="http://localhost:4000/">
  

  <meta property="og:url" content="http://localhost:4000/%E8%A7%82%E7%82%B9-%E6%83%B3%E8%BF%9B%E6%AD%A5%E7%9A%84%E7%AE%A1%E7%90%86%E8%80%85%E8%A6%81%E5%A4%9A%E8%AF%BB%E5%87%A0%E9%81%8D" />

  

  <title>
    
      【观点】想进步的管理者要多读几遍 &mdash; BertrandDigitalGarden
    
  </title>
</head>

  <body>
    <nav><div>
    <a class="internal-link" href="/"><b>BertrandDigitalGarden</b></a>
</div></nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>【观点】想进步的管理者要多读几遍</h1>
    <!-- 更新时间一直都是显示为构建时间，先屏蔽 -->
    <time datetime="">
      最后更新于 
      
    </time> 
  </div>

  <div id="notes-entry-container">
    <content>
      <html><body>
<ul>
  <li>
    <p>作者：费  敏</p>
  </li>
  <li>
    <p>来源：蓝血研究（lanxueyanjiu)</p>
  </li>
  <li>
    <p>蓝血研究文章，如需转载请通过后台向公众号申请</p>
  </li>
</ul>

<p>华为原高级副总裁费敏曾在华为大学高级管理研讨班上，针对“企业管理的目标是流程化组织建设”的讨论做了一个长点评，华为以电邮文件的方式予以发布。任正非特意写了按语：</p>

<p>1、应该作为华为大学的教材；</p>

<p>2、每位专家干部都要读一遍；</p>

<p>3、想进步的管理者要多读几遍。</p>

<p>全文如下：</p>

<p>企业管理的目标是流程化组织建设</p>

<p>——费敏在华为大学高级管理研讨班48期A班的点评总结</p>

<p>一、解决问题的方法</p>

<p>做事的方法是：先找到问题，然后找到根因，再找到解决措施，最后要关闭。核心就是一个，还原这个事情的本质，还原以后该是谁的，就是谁的。循此道理：流程的核心是要反映业务的本质。</p>

<p>比如，没有IPD，A产品的东西（经验教训等）就不能制度化地传递给B产品，这就是管理的系统缺失，如果我们把管理的系统缺失补上了改进了，提升就很快了。就不会重复犯错，成本就降低了。</p>

<p>二、公司三大业务流</p>

<p>一个公司就三件大事：</p>

<p>第一件把产品开发出来，产品从有概念开始，到面市。</p>

<p>第二个是把产品变现，要有客户买，形成订单，发货、安装、验收、回款；</p>

<p>只有上帝做的东西才没问题。当时没问题，时间长了也有问题:客户有这样那样的需求，产品要不断的改进升级。因此，有了第三件事情，网上有问题，发生了，就要解决，然后关闭（某代表处的问题解决了叫“解决”，全球此类问题都根治了才叫“关闭”）</p>

<p>这三件事情对应三大业务流。这三大业务流有起始终止。对应三个系统（IPD/LTC/ITR），还要有相应的组织去适配（不仅是流程IT）；也要和客户去匹配。很多订单要和客户去对接。</p>

<p>日复一日，年复一年，简单、海量、重复的工作怎么去做更好？就是先要把它流程化，模板化，固化下来。最后采用IT支撑。</p>

<p>公司三大业务流，日复一日,一年运行下来，就形成了公司的业绩：财务三张表。</p>

<p>三、业务、业务流、流程、组织以及和客户之间的关系</p>

<p>业务就上面的三件大事, 流程要匹配业务流，不长也不短，够用就行。其核心是：流程要反映业务的本质，尤其是完整系统的反映业务的本质。业务中的各关键要素及其管理不要在流程体系外循环。基于流程建设的管理体系（IPD/LTC/ITR），是一个运营系统，是一个业务操作系统（Business Operation System），其中最重要的是落实到组织中，就是流程化的组织建设和运作。构建公司的流程体系就是构建公司的运营系统，是要在流程中把质量、运营、内控、授权、财经的要素放到流程中去，一张皮运作。</p>

<p>业务是以客户为中心的，业务流也是从客户中来到客户中去。为什么流程要改进，一上流程就要不断改进？为什么流程改进一小步，绩效能改进一大步？就像火车，我们平时感觉不到它对现代化的贡献，但是十年下来，有火车比没有火车的时候效率更快。</p>

<p>目前已大到一年有上千亿的人民币在LTC的大肚子里面滚，他日复一日的在运转，流程每改进一小步，长时间run下来，对绩效（财务三张表）的贡献是很大的。</p>

<p>在流程和流程化组织建设中，我们需要参考业界标杆来设计。E公司的卓越运营(ITO/DSO/质量/成本/效率)在业界最具竞争力,我们就要学他们的LTC运作。在组织建设中，围绕着流程的项目型组织建设是当前的一个重点难点。（让蓝文广布置一个作业，公司对“流程化组织建设”可以讨论出个相对权威些的定义（目前是各自理解/解读），现在可以是1.0版本，以后2.0/3.0版本不断完善）</p>

<p>流程建设了之后，其实形成了一个系统。这样一个从客户中来，到客户中去，成就客户价值的业务流，通过系统（system）高效低成本地承载了实现了，不就是“以生存为底线、以客户为中心”吗？我们的业务流都瞄准着给客户解决问题、实现客户价值的，正是以客户为中心的最好体现。基于此系统再不断去改进，也就实现了“深淘滩、低作堰”。</p>

<p>四、流程的作用与人的作用？</p>

<p>为讨论此命题，可借鉴一下美国“人和制度的关系”（有意思的是，制度和系统是同一个英文词：system），美国的法治制度实际是个大平台，使美国总统能在上面更好地跳舞，驾驭局面的能力更强，因为他只需关注system覆盖之外的、更需要人的创造力和领导智慧的事务。所以美国虽是最小的政府，只有15个内阁成员，却覆盖全球事务。</p>

<p>我们公司现在15万人，管理者应该把精力和智慧放在挑战性的工作里面去，比如新业务、战略、创新、客户、市场拓展、干部培养选拔，还有一个容易被忽视的是，基于流程搞建设。这是很有挑战性且很重要的，必须领导者才能推动搞好，其他事都可以委托给别人去做,我以前也是不能理解为什么美国人把参与制宪的都称为fathers。</p>

<p>基于流程搞建设，更大的难度是受到很多的噪音、阻力和反弹。很容易人云亦云，随便找个借口就可以打发它。比如说，这个东西上来，我们的效率下降；这个流程好长好长，原来不是这样的；这个东西太难达成共识了……</p>

<p>流程建设不仅仅是把代表们解放出来，而是把所有人都解放出来。流程不是让大家失业的，是让大家更体现自己的价值。不仅是发挥主管的价值，更是发挥所有人的价值。因为他可以从海量、低价值、简单重复枯燥的工作中把每一个人解放出来。</p>

<p>曾经有人问丰田，你们为什么大量使用机器人、机器手。丰田说，我的第一诉求不是省人，哪怕人没有成本，也做不出来机器人的质量，机器人的效率特别高，不良品率极低。即使我们把雷锋全部招过来，也达不到机器人的质量成本效率。流程是让你的业务运作上一个大台阶，让人发挥智慧，去干更有价值/有创造力的活，比如呼唤炮火，很多难题，你也因此可腾出手来有精力去解决去改进了，因此丰田的全员改进是做得最好的。它给我们的启示：应对马拉松式激烈残酷竞争，海量简单重复枯燥的事，用流程系统去解决是最明智的选择。</p>

<p>我们今天坐在这里研讨，只是相对达成共识，比外面的噪音小一点。因为这个东西太容易夭折了，太容易被别人扔到一边了。</p>

<p>五、最顶级的管理是建系统</p>

<p>发现问题根本不可怕，应该是一种喜悦，因为能循着这个问题，找到管理的核心要点。管理不是发文，也不是立项。管理的核心是建体系，建系统。</p>

<p>其实到现在为止，现在最大的问题还在LTC上面，他承载了海量巨大的业务量。但是他是在一个没有系统的背景下承载的。就比如研发五万人，但没有IPD（不可想象）。这个就像300亿USD业务没有SYSTEM支撑。大家只好发文、发文再发文。兵来将挡水来土掩。就像没搞铁路建设，今天这里用三轮车，明天那里搞皮卡。</p>

<p>什么叫发文的方式，不行出了问题。就成立一个项目，任命一个工作组，再不行就变成一个部门。然后部门越搞越多，再重新调整。然后循环往复……我认为发文是打小布丁，是优化。LTC没有建立前，那是原始的管理方法。最好还是回到LTC流程上去整体解决。</p>

<p>这又回到那个问题。流程承载业务，业务在流程上跑，对业务的管理是沿着流程进行的（包括内控），至此，这个问题还只是运营问题。好比高铁分为建设和运营，真正的难题是建系统。这是最大的管理。这是顶级管理。为什么业务主管是流程的OWNER。所以要发挥OWNER的职责。</p>

<p>六、流程的责任人是谁？</p>

<p>LTC到底是个流程还是个业务?如果是流程，owner是谁？</p>

<p>我也来贡献一下自己的认识，我也是盲人，也是在摸象。假设我是广州办代表，那么我怎么看这个问题？我从上任第一天起，我看到了什么，该怎么做？我管的这摊子的核心是订发收回，其实就是LTC，最后形成广州办业绩：财务三张表。我为了实现自己的业绩，一个做法是，沿用以前的做法，就是各种自由式等方式，把他做下来。第二个做法，就是在我的任期内，上到LTC崭新的流程上，这是鸟枪换炮嘛。谁也不想总是小米加步枪嘛。</p>

<p>谁是广办最大的管理呢？除了客户关系、干部培养，和市场有关的高智商活动，我最重要的是，对应广办这100亿的业务，用崭新的LTC2.0来承载。但是问题来了，我能建立起这个系统吗？退一万步，假设我是诸葛亮，能搞定，我也难，因为我只是一个局部。其他代表每个人都建一个，这不可能吧。怎么办？因为我最迫切，我最懂一线业务实际，我最想要这个流程。我就和机关说，你们赶紧做好，我愿意做第一个深度合作的试点，公司LTC系统在广办建好用好的责任是我—–为什么说我是OWENR，如果不是这样，我随便找个理由，就把这个流程PASS掉了。即便我被迫用这个流程，也会把这个流程带入歧途。</p>

<p>所以，在广办建LTC是我最大的管理责任。为什么是最大的？是因为其他事情都好办。变革是最有挑战的事情。IBM为什么要变革，变革了他才能重生，他才能跳舞啊。郭士纳做的事情就是变革。</p>

<p>我们现在也是这样，LTC不是和我无关，它是我广办最大的管理。我们要从过去生产队式的管理，进化到现代化的管理，就是要建好高铁系统，运营好高铁系统。LTC就是这个高铁系统。</p>

<p>所以，认识事情还是要还原到它的本质，再看怎么办。所以这个问题，要先回到为什么要建LTC流程，建流程就是建管理体系，流程是管理体系的核心。</p>

<p>我为什么理解这个命题呢？咱们公司多年来遗留问题，一件事情要么你管，要么我管，要么大家都管（其实是都管不好）。以前，流程有什么问题，就把流程与IT拉过来骂一顿。现在看来LTC这件事上，业务主管和流程IT是夫妻关系，而且，在生育LTC这个儿子的问题上，业务主管更重要些，要让业务主管（主动配合流程IT）担负起流程建设的职责。</p>

<p>七、流程管理系统建设的关键问题？怎样进行流程管理？</p>

<p>1、我认为LTC现在TOP3问题是：</p>

<p>（1）没有统一认识。大家其实并没有达成一致。什么是LTC？LTC对我们意味着什么？怎么搞LTC？大家还是雾里看花，不清晰且没有共识。就像改革开放之前没有明确共识到一个国家的核心是把人民生活搞上去，怎么搞经济。</p>

<p>（2）没有一个SA组织。LTC一定要有一个常设总体架构组。这个总体架构组是什么呢？就是一群瞎子摸象，但每瞎子的头衔是SA，其目标是共同拼出一头真正的大象，而不是以前瞎子们那样无价值的争吵。变革太复杂又太重要，没有一个人能够高瞻远瞩、洞察一切。世上复杂的事情，都是瞎子摸象，谁都说的有道理（因为他摸的那个局部确是那么回事），但谁都没有说到整体系统的本质。以前大家就像一群各自表述的瞎子在叽叽喳喳。而SA的组织职责是，用全局和顶层视角，看LTC总体架构是什么该怎么做。谁做到过呢？北电、朗讯、阿尔卡特等都没有做好，只有爱立信做到了。关键是：要用组织的方式发育公司SA的核心职能，一群SA去吵，吵的目标不是以前那样互相不买账，而是建设性的吵出一个LTC总体架构1.0版本，拼成一个whole picture（美国宪法吵了116天）。然后版本2.0、3.0地往下走。</p>

<p>（3）业务OWNER就是流程责任人，这个事情要搞定，因为LTC单靠流程部门搞不定，单靠业务部门也搞不定。建IPD时，研发相当于控股（IPD流过的领域大部分在研发内）因此好搞，而LTC是重量级地穿过很多大部门，目前是没有控股股东的，一群股东在吵。如果一个业务流不在一个部门，穿越了很多部门的时候，公司级的OWNER是谁？建议的解决方案是：</p>

<p>LTC中谁的业务比重最大，谁就是最大股东，谁就成为OWNER</p>

<p>或者在他们上面加一个更高的领导成为OWNER，他对这个业务流要较熟。</p>

<p>2、IPD做了这么久，依然存在很多问题。</p>

<p>所以流程管理要做顶层设计，也要不断维护。</p>

<p>就像家里一样，要经常做大扫除。我们的流程也要靠版本去管理。所以SA很重要，既要做设计，也要做维护。需要有这个SA组织。</p>

<p>其次，部门墙是个问题（下面第八点详述）。还有大家习惯性认为控制点加上去，管理加上去，是为了防止风险，效率就一定会下降，这是大家习惯性思维。如果你这个业务本质清楚了，建了流程，时不时维护他，这个时候的管理体系应该是兼顾到流程、组织、运作、成本、质量的关系。以高铁为例，凡坐过高铁的就不会认为利用身份证识别增加抓通缉犯的功能就牺牲了高铁效率。其实成本和质量的关系也是这样的。有人总觉得搞定了质量，成本也就高了。其实沿着流程把质量搞好了，海量简单重复的事日常都按要求一次性做好过掉，不良品率降低，不返工不窝工，效率是最高的，成本是最低的。</p>

<p>其实变革也是这样，如果你不知道变革的本质，加上业务繁杂当期压力又大，你就会去吵。如果清楚本质，你就知道变革应该朝哪条路去走。</p>

<p>以前我们各个都是武工队，打得很漂亮。因为业务小，虽没有流程，但自然而然沿着这个天然的业务流（订发收回）走，也很通畅，响应快是我们的强项，我们要保持。现在15万人了，覆盖范围大了，全球了，海量了，产品线宽了，交付形式多样化了，必须有流程。而流程一上上去，会变慢会不适应，为什么变慢了，原来是武工队，是快的。但是这种快，可复制吗？可成长吗？它能线性增加得上去吗？比如，小舢板不可能线性得变大为驱逐舰，驱逐舰也不会叠加成航母。这是永恒的命题，任何公司都想发挥大公司的优势，保持小公司的高效。如果我们的流程反映了业务的本质，不让他长胖，变肥，让他永远健美。流程真的会使公司长得很大，但是像小公司一样健美。</p>

<p>能实现此目标的就是业务操作系统（Business Operation System），基于此系统的业务运营是卓越运营。</p>

<p>为什么日本电子产品今天几乎全军覆没？因为日本所有的照相机、WALKMAN、MP3、游戏机，学习机等都是烟囱式的产品。苹果把所有烟囱式的产品变成了一个智能手机。他的成本比日本一个照相机还便宜，使用和携带都更方便，客户满意度更高。日本把一个个东西做得有模有样，一个功能一个产品，最后却被苹果一个产品全部收掉。其实，管理也是这样。不要搞成多张皮，产生很多行管部门，人为割裂业务流。这又回到开头，一定要有一个SA总体架构组。变革里面特别忌讳你出一个烟囱，他出一个烟囱。要全面考虑，从顶层系统地去架构，谋定而后动。</p>

<p>八、什么是流程化组织建设？</p>

<p>LTC流程里大家谈得最多的是角色，我以为这里（LTC）核心是组织。大家如果只谈角色，就有点避重就轻了。组织不匹配流程，考核保持不变，那就像学校不变只要学生变，是搞不好的。刚才大家说了这么多，唯上的本质其实是领导比流程厉害。请示的是领导，不是流程这条线，我们还没有建成流程化组织。真正流程化组织是反官僚化的，是去部门墙的。</p>

<p>流程已经匹配了业务，但组织还是那个组织，组织没有匹配业务。这就会造成流程不匹配业务的表象，而且部门墙可能更严重。我们即使喊100年，也过渡不到共产主义。因此，我们要还原业务/组织/流程的逻辑关系是什么。这就是流程反映了业务本质，组织没有去匹配。不要以为变革只是几个部门几个人干的事，变革是整个公司的脱胎换骨。</p>

<p>九、“流程化组织建设”和“以客户为中心，以生存为底线”的关系</p>

<p>整个LTC、IPD流程不断优化，走向无穷的未来，绝对是走向以客户为中心的。他打中的是客户的10环，按IPD做出的产品，按LTC流程交付，用ITR把问题高效关闭，客户不满意吗？这三个流程、三件大事，好好的搞定了，并比竞争对手还好，质量好，成本低，效率更高，你说客户满不满意？</p>

<p>那么怎么实现“深淘滩、低作堰”？三个业务流（IPD/LTC/ITR）都成了系统，并达到了一个不断优化的境界，就是深淘滩、低作堰，就是以生存为底线。</p>

<p>很忌讳这里搞一摊子，那里搞一摊子，或者完整的LTC却一段段各自去搞。在管理上,学苹果产品(ALL in ONE)学得越像，你就会打倒别人。你越是像日本，你就会被别人打倒。</p>

<p>我是从哪里开始认识到这点的呢？当年BT对我们做第一次资格认证，他们只来了一个质量官，只用三天，就把我们定位了。他说：你们是一个万花筒、百宝箱，还是一个博览会。业界所有管理工具你们都有，但都是散落各处的零配件，看不到一个覆盖全流程的系统（system）。12项评分，最好的就是基建，管理系统是最低分。BT发现：</p>

<p>公司高管没有谁负责质量，没有质量OWNER。在丰田不谈流程，不谈变革，就谈全面质量管理，就是基于流程的全面管理；</p>

<p>问到质量方针是什么？沿着业务流走下来，大家都是东一句西一句，没有共识。</p>

<p>沿着业务全流程，分成一段段，每段都是李云龙，各自为战，各显神通。但是没有统一数据/IT、统一语言、统一方法。前面一段说日语，中间说德语，后面说汉语，从管理系统的角度看，长期运营的质量成本效率是难以确保的。</p>

<p>我们不能老是靠雷锋、焦裕禄取得成功。大家会搞疲的。要向苹果学习。当时苹果iphone一出来，日本厂商都不知道他们大难将至，现在已持续十几个季度亏损，很危险。现在谁还买他烟囱式的产品啊？管理也同此理，不是多，够用就行。我们若不去看各个管理之间是什么关系，就很容易搞成烟囱林立的管理体系。很多办事处说，我们是作战部门，背负了很多作战压力，公司很多行管部门插手进来，就像一个千手观音。其实核心业务流只有一个：LTC。所以，管理体系不能搞成烟囱式，因为是违背深淘滩，低作堰的，也不利于以客户为中心，内部没理顺，一定会影响外部客户满意。内部搞好了，一定会内顺外秀。（2013年9月2日）</p>
</body></html>
    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">反向链接：</h3>
      

      <div style="font-size: 0.9em">
        <p>
          There are no notes linking to this note.
        </p>
      </div>
      
    </side>
  </div>
</article>

<!-- <hr> -->

<!-- 图谱的性能太差，先屏蔽了 --></main>
      <footer><!-- <script src="https://giscus.app/client.js"
        data-repo="oldwinter/knowledge-garden"
        data-repo-id="R_kgDOHT-NGQ"
        data-category="备发布站的评论系统"
        data-category-id="DIC_kwDOHT-NGc4CQ3PF"
        data-mapping="og:title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script> -->
</footer>
    </div>
    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 400px; /* 悬浮卡片改高一点 */
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  /* #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  } */
</style>
<!-- 给悬浮预览卡片加滚动条。 -->
<div style="opacity: 0; display: none; overflow-y: scroll;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>
